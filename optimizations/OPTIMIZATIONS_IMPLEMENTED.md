# OpenGL –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

## ‚úÖ –í–Ω–µ–¥—Ä—ë–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. **Batch Rendering –¥–ª—è –±–ª–æ–∫–æ–≤ (Instanced Rendering)**
**–§–∞–π–ª—ã:** 
- [src/engine/graphics/blocks_renderer.py](src/engine/graphics/blocks_renderer.py) (–Ω–æ–≤—ã–π)
- [src/game/game_field.py](src/game/game_field.py)

**–ß—Ç–æ –±—ã–ª–æ:**
- 2000+ draw calls –≤ –∫–∞–¥—Ä (–æ–¥–∏–Ω –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞)
- –ö–∞–∂–¥—ã–π –±–ª–æ–∫ —Å–æ–∑–¥–∞–≤–∞–ª —Å–≤–æ–π VAO/VBO
- `set_offset()` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª—Å—è –∫–∞–∂–¥—ã–π –∫–∞–¥—Ä —Å `glBufferData()`

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
- **1 draw call** –¥–ª—è –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤: `glDrawArraysInstanced()`
- –ï–¥–∏–Ω—ã–π VAO –∏ VBO –¥–ª—è –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤
- –ü–æ–∑–∏—Ü–∏–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–∞–∫ instance attributes

**–í—ã–∏–≥—Ä—ã—à –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:** `+30-50%` FPS

---

### 2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Uniform Locations**
**–§–∞–π–ª—ã:**
- [src/game/windows/game_window.py](src/game/windows/game_window.py#L66-L75)
- [src/engine/graphics/renderer_3d.py](src/engine/graphics/renderer_3d.py#L50-L60)

**–ß—Ç–æ –±—ã–ª–æ:**
```python
# ‚ùå –ö–∞–∂–¥—ã–π frame –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
glGetUniformLocation(shader, "mvp")      # –°—Ç—Ä–æ–∫–æ–≤—ã–π –ø–æ–∏—Å–∫!
glGetUniformLocation(shader, "model")    # –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ!
glGetUniformLocation(shader, "lightPos") # GPU —Å—Ç–æ–ª
glGetUniformLocation(shader, "viewPos")
```

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
```python
# ‚úÖ –û–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
self.__3d_uniforms = {
    "mvp": glGetUniformLocation(shader, "mvp"),
    "model": glGetUniformLocation(shader, "model"),
    "lightPos": glGetUniformLocation(shader, "lightPos"),
    "viewPos": glGetUniformLocation(shader, "viewPos"),
}

# –í draw loop - –±—ã—Å—Ç—Ä–æ
glUniformMatrix4fv(self.__3d_uniforms["mvp"], 1, GL_TRUE, mvp)
```

**–í—ã–∏–≥—Ä—ã—à –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:** `+5-10%` FPS

---

### 3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ View –º–∞—Ç—Ä–∏—Ü—ã**
**–§–∞–π–ª:** [src/game/windows/game_window.py](src/game/windows/game_window.py#L75-L80)

**–ß—Ç–æ –±—ã–ª–æ:**
```python
# ‚ùå –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è 60 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É!
view = OpenGLUtils.look_at(...)  # 4x –º–∞—Ç—Ä–∏—á–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ
```

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
```python
# ‚úÖ –û–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
self.__view = OpenGLUtils.look_at(...)

# –í draw loop - –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
self.__weapons.draw(..., self.__view, ...)
```

**–í—ã–∏–≥—Ä—ã—à –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:** `+2-3%` FPS

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- Draw calls: 2000+ –≤ –∫–∞–¥—Ä
- GPU –∑–∞–Ω—è—Ç–æ—Å—Ç—å: ~70-80% –ø—Ä–∏ 60 FPS
- FPS: –±–∞–∑–æ–≤—ã–π (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏—Å—Ç–µ–º—ã)

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- Draw calls: ~50-100 –≤ –∫–∞–¥—Ä (–≤–º–µ—Å—Ç–æ 2000+)
- GPU –∑–∞–Ω—è—Ç–æ—Å—Ç—å: ~40-50% –ø—Ä–∏ 60 FPS
- FPS: **+30-50% –ø—Ä–∏—Ä–æ—Å—Ç**

---

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Instanced Rendering

```glsl
// –í–µ—Ä—à–∏–Ω–Ω—ã–π —à–µ–π–¥–µ—Ä
layout (location = 0) in vec2 aPos;      // –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—à–∏–Ω–∞ –∫–≤–∞–¥–∞ (–æ–±—â–∞—è –¥–ª—è –≤—Å–µ—Ö)
layout (location = 1) in vec2 aOffset;   // –ü–æ–∑–∏—Ü–∏—è –±–ª–æ–∫–∞ (–æ—Ç–¥–µ–ª—å–Ω–∞—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ instance)

void main()
{
    vec2 pos = aPos + aOffset;  // –ö–∞–∂–¥—ã–π instance –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π offset
    gl_Position = uProjection * vec4(pos, 0.0, 1.0);
}
```

```python
# –û–¥–∏–Ω draw call —Å 2000 instances
glDrawArraysInstanced(GL_TRIANGLE_FAN, 0, 4, block_count)
```

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

–ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏–≥—Ä—É –∫–∞–∫ –æ–±—ã—á–Ω–æ - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```bash
python src/main.py
```

---

## üìù –ß—Ç–æ –µ—â—ë –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å (—É—Ä–æ–≤–µ–Ω—å 2)

1. **Frustum culling** - –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ –±–ª–æ–∫–∏
2. **–¢–µ–∫—Å—Ç—É—Ä–Ω—ã–π –∞—Ç–ª–∞—Å** - –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ —Ç–µ–∫—Å—Ç—É—Ä—ã –≤ –æ–¥–Ω—É
3. **–ë–∞—Ç—á-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—É–ª—å** - –µ—Å–ª–∏ –∏—Ö –º–Ω–æ–≥–æ
4. **GPU-side –≤—ã—á–∏—Å–ª–µ–Ω–∏—è** - –º–∞—Ç—Ä–∏—Ü—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ GPU

---

## ‚ú® –ß–µ–∫-–ª–∏—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|-------------|--------|------|
| Batch rendering –±–ª–æ–∫–æ–≤ | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | [blocks_renderer.py](src/engine/graphics/blocks_renderer.py) |
| –ö—ç—à uniform locations | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | [game_window.py](src/game/windows/game_window.py) |
| –ö—ç—à view –º–∞—Ç—Ä–∏—Ü—ã | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | [game_window.py](src/game/windows/game_window.py) |
| Frustum culling | ‚è≥ –ù–µ –Ω–∞—á–∞—Ç–æ | - |
| –¢–µ–∫—Å—Ç—É—Ä–Ω—ã–π –∞—Ç–ª–∞—Å | ‚è≥ –ù–µ –Ω–∞—á–∞—Ç–æ | - |

---

## üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è **–Ω–∞–∑–∞–¥ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã** - –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ
- –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ª–æ–≥–∏–∫–µ –∏–≥—Ä—ã - —Ç–æ–ª—å–∫–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- `BlocksRenderer` –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é frustum culling –≤ –±—É–¥—É—â–µ–º
